<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Registro de Usuarios</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        h1, h2 { color: #0056b3; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        #usuarios-lista { margin-top: 20px; border: 1px solid #ddd; padding: 10px; border-radius: 4px; background-color: #e9ecef; }
        .usuario-item { margin-bottom: 8px; padding: 10px; background-color: #fff; border-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        input[type="text"], input[type="email"], input[type="number"], button {
            padding: 10px; margin-right: 8px; border: 1px solid #ccc; border-radius: 4px;
            box-sizing: border-box; /* Para que el padding no afecte el ancho total */
            width: calc(33% - 16px); /* Ajuste para tres inputs */
            margin-bottom: 10px;
        }
        button { cursor: pointer; background-color: #007bff; color: white; border: none; font-weight: bold; }
        button:hover { background-color: #0056b3; }
        #mensaje-agregar { margin-top: 10px; padding: 8px; border-radius: 4px; }
        .error { background-color: #ffe0e0; color: #d32f2f; border: 1px solid #d32f2f; }
        .success { background-color: #e0ffe0; color: #388e3c; border: 1px solid #388e3c; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Gestión de Registro de Usuarios</h1>

        <h2>Agregar Nuevo Usuario</h2>
        <input type="text" id="nombre" placeholder="Nombre">
        <input type="text" id="apellido" placeholder="Apellido">
        <input type="text" id="cedula" placeholder="Cédula">
        <button onclick="agregarUsuario()">Agregar Usuario</button>
        <p id="mensaje-agregar"></p>

        <h2>Usuarios Existentes</h2>
        <button onclick="cargarUsuarios()">Recargar Usuarios</button>
        <div id="usuarios-lista">
            </div>
    </div>

    <script>
        // Función para cargar usuarios desde el backend de Python
        async function cargarUsuarios() {
            const usuariosLista = document.getElementById('usuarios-lista');
            usuariosLista.innerHTML = 'Cargando usuarios...';

            try {
                const response = await fetch('/usuarios'); // Llama al endpoint de Flask
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const usuarios = await response.json();

                usuariosLista.innerHTML = ''; // Limpiar lista
                if (usuarios.length === 0) {
                    usuariosLista.innerHTML = '<p>No hay usuarios registrados.</p>';
                    return;
                }
                usuarios.forEach(usuario => {
                    const div = document.createElement('div');
                    div.className = 'usuario-item';
                    // Muestra los nuevos campos
                    div.textContent = `ID: ${usuario.id}, Nombre: ${usuario.nombre}, Apellido: ${usuario.apellido}, Cédula: ${usuario.cedula}`;
                    usuariosLista.appendChild(div);
                });
            } catch (error) {
                console.error('Error al cargar usuarios:', error);
                usuariosLista.innerHTML = `<p class="error">Error al cargar usuarios: ${error.message}</p>`;
            }
        }

        // Función para agregar un nuevo usuario
        async function agregarUsuario() {
            const nombreInput = document.getElementById('nombre');
            const apellidoInput = document.getElementById('apellido'); // Nuevo
            const cedulaInput = document.getElementById('cedula');     // Nuevo
            const mensajeAgregar = document.getElementById('mensaje-agregar');

            const nombre = nombreInput.value.trim();
            const apellido = apellidoInput.value.trim();
            const cedula = cedulaInput.value.trim();

            if (!nombre || !apellido || !cedula) {
                mensajeAgregar.textContent = 'Por favor, rellena todos los campos.';
                mensajeAgregar.className = 'error';
                return;
            }

            try {
                const response = await fetch('/agregar_usuario', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ nombre, apellido, cedula }), // Envía los nuevos campos
                });

                const result = await response.json();

                if (response.ok) {
                    mensajeAgregar.textContent = result.message;
                    mensajeAgregar.className = 'success';
                    nombreInput.value = ''; // Limpiar campos
                    apellidoInput.value = '';
                    cedulaInput.value = '';
                    cargarUsuarios(); // Recargar la lista de usuarios
                } else {
                    mensajeAgregar.textContent = `Error: ${result.error || 'Algo salió mal'}`;
                    mensajeAgregar.className = 'error';
                }
            } catch (error) {
                console.error('Error al agregar usuario:', error);
                mensajeAgregar.textContent = `Error de conexión: ${error.message}`;
                mensajeAgregar.className = 'error';
            }
        }

        // Cargar usuarios al cargar la página
        document.addEventListener('DOMContentLoaded', cargarUsuarios);
    </script>
</body>
</html>